<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Account</title>

   <!-- Vue.js script -->
   <script src="https://unpkg.com/vue"></script>

   <!-- Google poppins font -->
   <link href="https://fonts.googleapis.com/css?family=Poppins" rel="stylesheet">

   <!-- Font Awesome Icon Library (used for stars) -->
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
   <style>
      * {
         margin: 0px;
         padding: 0px;
         box-sizing: border-box;
      }

      html {
         scroll-behavior: smooth;
      }

      body {
         background: #ffffff;
      }

      /** Give all elements a transition and Poppins font */
      * {
         font-family: "Poppins";
         transition: all 0.4s;
         -webkit-transition: all 0.4s;
         -o-transition: all 0.4s;
         -moz-transition: all 0.4s;
      }

      button:hover {
         cursor: pointer;
      }

      a:hover {
         cursor: pointer;
      }

      div {
         width: auto;
      }

      .wrapper {
         display: grid;
      }

      .table {
         display: table;
         background-color: #fafafa;
         border-collapse: collapse;
         width: 86%;
         margin: 40px auto;

         justify-content: space-evenly;
      }

      .row {
         width: 100%;
         background: #fafafa;
         height: 50px;
      }

      .row:hover {
         background-color: #ecf2fa;
         cursor: pointer;
      }

      td {
         padding-left: 12px;
         min-width: auto;
      }

      .log-out {
         padding-top: 8px;
         padding-bottom: 8px;
         padding-left: 30px;
         padding-right: 30px;

         background-color: rgb(202, 39, 39);
         color: white;

         border: none;
         border-radius: 10px;

         font-size: large;
      }

      .log-out:hover {
         background-color: rgb(172, 34, 34);
         padding-left: 35px;
         padding-right: 35px;
      }

      .header {
         padding: 10px 16px;
         background: #275FCF;
         color: #f1f1f1;
         width: 100%;
         position: fixed;
         z-index: 999;
      }

      .header-title {
         font-weight: 600;
         letter-spacing: 1px;
         font-size: large;
         float: left;
         color: white;
         text-decoration: none;
      }

      .header-links {
         float: right;
         margin-right: 25px;
      }

      .header-link {
         font-size: small;
         text-decoration: none;
         color: white;
         margin-right: 25px;
      }



      .header-link:hover {
         color: white;
      }

      .header-link-inactive {
         color: #A9BFEB;
      }

      .header-link-active {
         font-weight: 600;
      }

      .big-bold {
         font-weight: bold;
         font-size: 18px;
      }

      .column-left {
         float: left;
      }

      .column-right {
         float: right;
      }

      .column {
         position: relative;
      }

      .error {
         color: rgb(218, 49, 49);
         font-size: medium;
      }

      .align-content-right {
         text-align: right;
         padding-top: 10px;
         padding-right: 20px;
      }

      .align-content-left {
         text-align: left;
         padding-top: 10px;
         padding-left: 20px;
      }

      input {
         width : 90%;
         padding-left: 5px;
         padding-right: 5px;
         padding-top: 3px;
         padding-bottom: 3px;
         outline: none;
         border-radius: 3px;
      }

      input:hover {
         background-color: rgb(228, 228, 228);
      }
   </style>

</head>

<body>
   <div id="vue" class="wrapper">
      <div class="header">
         <div><a href="http://localhost:8080/WebProject" class="header-title">FakeAirbnb
            </a></div><a href="http://localhost:8080/WebProject" class="header-title"></a>
         <div class="header-links"><a href="http://localhost:8080/WebProject" class="header-title"></a><a
               href="http://localhost:8080/WebProject/" class="header-link header-link-inactive">Apartments</a> <a
               href="http://localhost:8080/WebProject/reservations" class="header-link header-link-inactive">My
               reservations</a> <a href="http://localhost:8080/WebProject/account"
               class="header-link header-link-active">Account</a></div>
      </div>
      <div><button type="button" class="log-out" style="margin-top: 100px; margin-left: 86%;" @click="logout">Log out</button></div>

      <div style="margin:0 auto; margin-top: 150px; width: 35%; height: fit-content; background-color: rgb(228, 228, 228); border-radius: 5px;
            display: grid;
            padding-top: 30px;
            padding-bottom: 30px;
            padding-left: 20px;
            padding-right: 20px;
            grid-template-columns: repeat(2, 1fr);
            grid-template-rows: repeat(3, 1fr);
            grid-column-gap: 50px;
            grid-row-gap: 20px;"> 

            <div style="grid-area: 1 / 1 / 2 / 2;">
               <input placeholder="Username" style="width: 90%;" disabled v-model="username">
            </div>
            <div style="grid-area: 1 / 2 / 2 / 3;">
               <input type="password" placeholder="Password" v-model="password">
            </div>
            <div style="grid-area: 2 / 1 / 3 / 2;">
               <input placeholder="Email" v-model="email">
            </div>
            <div style="grid-area: 3 / 1 / 4 / 2;">
               <input placeholder="First name" v-model="firstName"> 
            </div>
            <div style="grid-area: 3 / 2 / 4 / 3;">
               <input placeholder="Last name" v-model="lastName">
            </div>
      </div>

      <div style="margin: 0 auto; margin-top: 50px;">
         <button class="button green-button" @click="update">Update</button>
      </div>
      <div style="margin:0 auto; margin-top: 30px;"> {{message}} </span>

   </div>


   <!-- Axios -->
   <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
   <!-- Vue.js implementation -->   
   <script type="application/javascript">
      let vue = new Vue({
         el : "#vue",
         data : {
            username : "",
            password : "",
            email : "",
            firstName : "",
            lastName : "",
            message : ""
         },
         methods : {
            getUser() { 
               axios.get("/WebProject/data/users/self")
                  .then(response => {
                     if (response.data) {
                        vue.username = response.data.key
                        vue.password = response.data.password
                        vue.email = response.data.email
                        vue.firstName = response.data.person.firstName
                        vue.lastName = response.data.person.lastName
                     } 
                  })
            },
            update() {
               let account = {
                  key : vue.username,
                  password : vue.password,
                  email : vue.email,
                  person : {
                     firstName : vue.firstName,
                     lastName : vue.lastName
                  } 
               }
               axios.put("/WebProject/data/users", account)
                  .then(response => {
                     if (response.data) {
                        vue.message = "Successfully updated account."
                     }
                  })
                  .catch(error => {
                    if (error.data) {
                      vue.message = error.data
                    }
                    else {
                      vue.message = "Failed to update"
                    }
                  })
            },
            logout : function() {
            axios.post("http://localhost:8080/WebProject/data/auth/logout")
                .then(function(response) {
                    if (response.status == 200) {
                        window.location.href = "http://localhost:8080/WebProject/login"
                    }
                    else {
                        message = "Failed to log out."
                    }
                })
            }
          },
         beforeMount() {
            this.getUser()
         }
      })
   </script>



</body>

</html>